# AIChatFlutter - Чат-приложение с ИИ

AIChatFlutter - это мультиплатформенное приложение для общения с искусственным интеллектом, разработанное с использованием Flutter. Приложение поддерживает работу как с OpenRouter.ai, так и с VseGPT.ru, предоставляя гибкие возможности для взаимодействия с различными языковыми моделями.

## Поддержка API

### OpenRouter.ai
- Баланс отображается в долларах ($)
- Стоимость сообщений рассчитывается в долларах за миллион токенов
- Широкий выбор языковых моделей от разных провайдеров
- Единый API для доступа к различным моделям

### VseGPT.ru
- Баланс отображается в рублях (₽)
- Стоимость сообщений рассчитывается в рублях за тысячу токенов
- Доступ к популярным моделям с оплатой в рублях
- Оптимизировано для пользователей из России

## Структура проекта

Основные директории и файлы:

- `lib/` - Основной код приложения
  - `main.dart` - Точка входа в приложение
  - `api/` - Модули для работы с API
    - `openrouter_client.dart` - Универсальный клиент для работы с OpenRouter и VseGPT
  - `models/` - Модели данных
    - `message.dart` - Модель сообщения с поддержкой токенов и стоимости
  - `providers/` - State management
    - `chat_provider.dart` - Провайдер для управления состоянием чата
  - `services/` - Сервисы
    - `database_service.dart` - Сервис для работы с локальной базой данных
    - `analytics_service.dart` - Сервис для сбора и анализа статистики
  - `screens/` - Экраны приложения
    - `chat_screen.dart` - Основной экран чата
- `android/`, `ios/`, `windows/`, `linux/` - Платформо-зависимые конфигурации
- `assets/` - Ресурсы приложения
- `pubspec.yaml` - Зависимости проекта

## Основные модули

### ChatProvider
- Управление состоянием чата и историей сообщений
- Взаимодействие с API (OpenRouter/VseGPT)
- Отслеживание баланса и расходов
- Управление моделями и их настройками

### Message
- Хранение текста сообщений
- Учет использованных токенов
- Расчет стоимости сообщений
- Метаданные (временные метки, модель)

### OpenRouterClient
- Унифицированный интерфейс для работы с API
- Автоматическое определение провайдера (OpenRouter/VseGPT)
- Форматирование цен в соответствии с провайдером
- Обработка ошибок и повторные попытки

### DatabaseService
- Локальное хранение истории сообщений
- Кэширование данных
- Экспорт истории
- Статистика использования

### AnalyticsService
- Сбор статистики использования
- Анализ эффективности моделей
- Отслеживание времени ответа
- Анализ использования токенов

## Функциональность приложения

### Основные возможности
- Обмен сообщениями с различными языковыми моделями
- Выбор модели из доступного списка
- Отображение баланса в соответствующей валюте ($/₽)
- Подсчет стоимости каждого сообщения
- Отслеживание использования токенов

### Управление чатом
- Сохранение истории сообщений
- Экспорт истории в JSON
- Копирование сообщений в буфер обмена
- Очистка истории

### Аналитика
- Статистика использования моделей
- Анализ времени ответа
- Отслеживание расхода токенов
- Экспорт аналитических данных

### Интерфейс
- Темный режим
- Адаптивный дизайн
- Поддержка русского и английского языков
- Информативные уведомления

### Технические особенности
- Кроссплатформенность (Android, iOS, Windows, Linux)
- Локальное хранение данных
- Оффлайн доступ к истории
- Обработка ошибок сети

## Процесс авторизации

Приложение использует двухэтапную авторизацию через API ключ и PIN-код:

1. **Первичная авторизация**:
   - Введите API ключ от OpenRouter.ai (начинается с `sk-or-v1-`) или VSEGPT (начинается с `sk-or-vv-`)
   - Система автоматически определит провайдера по формату ключа
   - Проверит баланс на соответствующем сервисе
   - Если баланс положительный, сгенерирует 4-значный PIN-код
   - Сохранит ключ и PIN в локальной базе данных приложения

![Экран ввода ключа](screenshots/screen1.png)

2. **Последующие входы**:
   - При повторном запуске предложит ввести PIN-код
   - При успешном вводе PIN - откроет главный экран приложения
   - При неверном PIN - покажет ошибку
   - Есть возможность сбросить ключ и ввести новый

![Окно ввода PIN](screenshots/screen2.png)
![Главное окно чат-бота](screenshots/screen3.png)
![Окно ввода PIN при повторном входе](screenshots/screen4.png)

## Начало работы

1. Клонируйте репозиторий
2. Создайте файл `.env` на основе `.env.example`
3. Добавьте свой API ключ (OpenRouter или VseGPT)
4. Следуйте инструкциям в [INSTALL.md](INSTALL.md) для установки зависимостей и запуска

## Конфигурация

Для работы приложения необходимо указать в файле `.env`:
- `OPENROUTER_API_KEY` - API ключ от OpenRouter.ai или VseGPT.ru
- `BASE_URL` - URL API (https://openrouter.ai/api/v1 или https://api.vsetgpt.ru/v1)
- `MAX_TOKENS` - Максимальное количество токенов для ответа
- `TEMPERATURE` - Температура генерации (0.0 - 1.0)
